<!DOCTYPE html>
<html>
<head>
    <title>Protocol Portal | Phase 2</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0052ff; --danger: #ff4d4d; --success: #00fb5a; --bg: #050505; }
        body { background-color: var(--bg); color: #fff; font-family: 'Inter', sans-serif; text-align: center; margin: 0; padding: 20px; }
        .container { max-width: 650px; margin: 40px auto; }
        h1 { font-weight: 700; color: var(--primary); letter-spacing: -1px; }
        .warning-box { background: rgba(255, 171, 0, 0.1); border: 1px solid #ffab00; padding: 25px; border-radius: 12px; margin-bottom: 30px; text-align: left; font-size: 0.95rem; }
        video, .image-container { width: 100%; max-width: 600px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); background: #111; }
        .image-container { position: relative; height: 350px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .image-container img { width: 100%; height: 100%; object-fit: cover; opacity: 0.3; filter: grayscale(100%); }
        .question-overlay { position: absolute; padding: 30px; font-size: 1.25rem; font-weight: 400; color: var(--success); text-shadow: 0 2px 12px rgba(0,0,0,0.9); }
        #userFeed { position: fixed; bottom: 20px; right: 20px; width: 120px; height: 160px; border-radius: 12px; border: 2px solid var(--primary); background: #000; object-fit: cover; z-index: 100; transform: scaleX(-1); display: none; }
        #timer { font-size: 36px; font-weight: 700; color: var(--danger); margin-bottom: 20px; }
        textarea { width: 100%; max-width: 580px; padding: 18px; border-radius: 8px; margin-bottom: 20px; background: #0a0a0a; color: #fff; border: 1px solid #333; font-family: inherit; font-size: 1rem; }
        button { background: var(--primary); color: #fff; padding: 18px 45px; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; }
    </style>
</head>
<body>
    <video id="userFeed" autoplay playsinline muted></video>

    <div class="container" id="box">
        <h1>Phase 2: Protocol Entry</h1>
        <div class="warning-box">
            <strong>Security Protocol</strong>
            - 60 seconds for technical responses.<br>
            - Camera feed must remain active.<br>
            - <strong>Single-Entry:</strong> This application email can only be initialized once.
        </div>
        <input type="email" id="userEmail" style="width:100%; max-width:580px; padding:18px; margin-bottom:20px; background:#0a0a0a; border:1px solid #333; color:white;" placeholder="Enter Application Email">
        <br>
        <button onclick="start()">Initialize Protocol</button>
    </div>

    <script>
        const FORMSPREE_URL = "https://formspree.io/f/xojnqbba"; 
        let step = 0; let time = 60; let clock; let data = { email: "" };
        
        const questions = [
            "", 
            "To begin, please state your full name and nationality. We'd love to get to know you better—what experiences have you had in the Web3 space, and why do you feel you’re the right fit for this role?",
            "", // Video 1 placeholder
            "", // Video 2 placeholder
            "A user comes to you crying because they lost their seed phrase and they want you to 'reset' their account. How do you explain the reality of self-custody to them without being a jerk?",
            "When you see a new token launch on Base, what is the #1 technical 'red flag' you check for on-chain to make sure it isn't a Honey Pot or a scam?",
            "We are building a high-signal inner circle. What is the one unique skill or perspective you bring that we can't find in anyone else?",
            "Explain the difference between 'Mainnet' and 'Testnet'. Why is it dangerous to skip testing on Base Sepolia before going live?",
            "If protocol TVL drops 50% in one hour but the code is secure, what is your message to the community?",
            "What is 'Slippage'? If a user sets it to 20% on a high-liquidity pair, are they protecting or hurting themselves?",
            "Explain the risk of Social Engineering in crypto. Give one example of how a scammer might try to trick a Phase 2 member.",
            "This protocol requires 100% conviction. If accepted, what is your primary contribution to the ecosystem over the next 12 months?",
            "Final Step: Regarding our operations, please state your expected bi-weekly compensation in USDT and confirm if you are capable of aligning your workflow with the US Time Zone (EST/PST)."
        ];

        async function start() { 
            data.email = document.getElementById('userEmail').value.toLowerCase().trim();
            if(!data.email.includes('@')) return alert("Valid email required");
            if(localStorage.getItem('done_' + data.email)) return alert("Access Denied.");

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                window.stream = stream;
                document.getElementById('userFeed').srcObject = stream;
                document.getElementById('userFeed').style.display = "block";
                step = 1; render(); 
                // No timer start here for Step 1
            } catch (e) { alert("Camera access required."); }
        }

        function tick() { 
            // Timer only ticks if it's NOT step 1 and NOT step 12
            if (step > 1 && step < 12) {
                time--; 
                document.getElementById('timer').innerText = time + "s"; 
                if(time <= 0) next(); 
            }
        }

        async function next() { 
            data['ans' + step] = document.getElementById('ans') ? document.getElementById('ans').value : "";
            
            if(step < 12) { 
                step++; 
                time = 60; 
                render(); 
                
                // Clear and restart clock only for technical steps
                clearInterval(clock);
                if (step > 1 && step < 12) {
                    clock = setInterval(tick, 1000);
                }
            } 
            else { 
                clearInterval(clock);
                document.getElementById('box').innerHTML = "<h1>Submission in progress...</h1>";
                await fetch(FORMSPREE_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
                localStorage.setItem('done_' + data.email, 'true'); 
                if(window.stream) window.stream.getTracks().forEach(t => t.stop());
                document.getElementById('box').innerHTML = "<h1 style='color:var(--success)'>Entry Successful</h1><p>Transmission complete.</p>"; 
            }
        }

        function render() {
            let media;
            let timerDisplay = (step === 1 || step === 12) ? "Flexible Time" : time + "s";

            if (step === 1 || step >= 4) {
                media = `<div class="image-container"><img src="avatar.jpg.jpeg"><div class="question-overlay">${questions[step]}</div></div>`;
            } else {
                let vNum = step - 1; 
                media = `<video autoplay playsinline muted src="video${vNum}.MP4" onloadedmetadata="this.muted=false; this.play();" style="width:100%; border-radius:16px;"></video>`;
            }

            document.getElementById('box').innerHTML = `
                <div id="timer">${timerDisplay}</div>
                ${media}<br>
                <textarea id="ans" placeholder="Provide your answers" autofocus></textarea><br>
                <button onclick="next()">Submit Response</button>
            `;
        }
    </script>
</body>
</html>
